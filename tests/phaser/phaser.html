<!DOCTYPE html>
<html>
	<head lang = "en">
		<meta charset = "UTF-8">
		<title></title>
		<script src = "../../phaser/build/phaser.js" type = "text/javascript"></script>
		<script src = "../../TeachSite/JQuery.js" type = "text/javascript"></script>
	</head>
	<body>
		<script>
			var game = new Phaser.Game(800, 600, Phaser.Auto, 'phaser-example', {preload: Preload, create: Create, render: Render});

			var graphLines = [];
			var points = [];
			var point;

			var handler = [];
			var line = [];
			var click = false;

			var count = 0;
			var handlerCount = 0;
			var originalHandlerCount;

			var keyPressed = [];

			function Preload() {
				//load images
				game.load.image('point', 'bitmap.png');
				game.load.image('transparent', 'transparentPoint.png');
			}

			function Create() {
				game.stage.backgroundColor = '#FF0000';

				//create lines of graph
				for(var i = 50; i < 800; i += 50) {
					graphLines[i / 50 - 1] = new Phaser.Line(i, 0, i, 600);
				}
				for(i = 50; i < 600; i += 50) {
					graphLines[i / 50 + 14] = new Phaser.Line(0, i, 800, i);
				}

				count = 0;
				for(i = 35; i < 750; i += 50) {
					for(var j = 35; j < 550; j += 50) {
						points[count] = game.add.button(i, j, 'transparent', CreateLine, this, 'over', 'out');
						points[count].onInputOver.add(Over, this);
						points[count].onInputOut.add(Out, this);
						count++;
					}
				}

				keyPressed[0] = game.input.keyboard.addKey(Phaser.Keyboard.ENTER);
				keyPressed[0].onDown.add(FinishLine, this);
			}

			/**
			 * Creates lines based on clicked points. When 4 are clicked will automatically close the quadrilateral.
			 * @param pointer
			 * @constructor
			 */
			function CreateLine(pointer) {
				if(!click) {
					originalHandlerCount = handlerCount;
					console.log("handlerCount = ", handlerCount);
					handler[handlerCount] = game.add.sprite(pointer.x, pointer.y, 'point'); //places point at clicked spot
					console.log("handler[handlerCount] = ", handler[handlerCount]);
					handlerCount++;
					console.log("handlerCount = ", handlerCount);
					handler[handlerCount] = handler[handlerCount-1]; //saves the first known clicked spot

					handlerCount++;
					console.log("handlerCount = ", handlerCount);

					click = true;
				}
				else {
					handler[handlerCount] = game.add.sprite(pointer.x, pointer.y, 'point'); //places points at clicked spots

					line[count] = new Phaser.Line(handler[handlerCount-1].x + 15, handler[handlerCount-1].y + 15,
							handler[handlerCount].x + 15, handler[handlerCount].y + 15); //draws lines between handlers
					count++;

					handlerCount++;
				}
			}

			function FinishLine() {
				line[count] = new Phaser.Line(handler[handlerCount - 1].x + 15, handler[handlerCount - 1].y + 15,
							handler[originalHandlerCount].x + 15, handler[originalHandlerCount].y + 15);
			}

			/**
			 * creates point image at hovered over point on graph.
			 * @param pointTransparent
			 * @constructor
			 */
			function Over(pointTransparent) {
				point = game.add.sprite(pointTransparent.x, pointTransparent.y, 'point');
			}

			/**
			 * destroys point when mouse moves out
			 * @constructor
			 */
			function Out() {
				point.destroy();
			}

			/**
			 * Renders the lines as they are created.
			 * @constructor
			 */
			function Render() {
				for(var i = 0; i < graphLines.length; i++) {
					game.debug.geom(graphLines[i], "#000000");
				}
				for(i = 0; i < line.length; i++) {
					game.debug.geom(line[i], "#FFFFFF");
				}
			}
		</script>
	</body>
</html>